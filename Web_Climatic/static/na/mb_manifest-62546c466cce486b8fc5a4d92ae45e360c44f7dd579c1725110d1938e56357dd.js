addthis_loader={initted:!1,floater:!1,follow:!1,script_src:null,is_admin:null,share_url:null,layer_opts:{theme:"transparent",share:{position:"left",services:"twitter,facebook,email,more",offset:{top:"60%"}},responsive:{maxWidth:"479px"}},init:function(script_src,opts){this.is_admin=window.location.href.search("mbcms")>=0,opts.floater&&(this.floater=opts.floater),opts.follow&&(this.follow=opts.follow),opts.top&&(addthis_loader.layer_opts.share.offset.top=opts.top),opts.addthis_url&&(addthis_loader.share_url=opts.addthis_url),this.script_src=script_src,"undefined"!=typeof opts.lazy_load&&0!=opts.lazy_load||(addthis_loader.initted=!0)},scriptLoaded:function(){"undefined"!=typeof addthis?(console.log("addthis script loaded"),addthis_loader.floater&&(addthis.layers(addthis_loader.layer_opts),addthis_loader.initListeners()),addthis_loader.share_url&&addthis.update("share","url",addthis_loader.share_url)):window.setTimeout(function(){addthis_loader.scriptLoaded()},500)},initListeners:function(){addthis.addEventListener("addthis.ready",addthis_loader.addthisReady)},addthisReady:function(){var h=.5*$(window).height();$(window).scroll(function(){$(window).scrollTop()>h&&!$(".addthis-smartlayers").hasClass("done")&&(console.log("show addthis float"),$(".addthis-smartlayers").css({opacity:0,visibility:"visible"}).animate({opacity:1}),$(".addthis-smartlayers").addClass("done"))})}},$(document).ready(function(){addthis_loader.initted&&!addthis_loader.is_admin&&(addthis_config={data_track_addressbar:!1,services_compact:"facebook,twitter,reddit,print,email,gmail,stumbleupon"},$.getScript(addthis_loader.script_src,addthis_loader.scriptLoaded))});var mb_utils={init:function(){this._extendJquery(),this._extendJavascript()},_extendJquery:function(){jQuery.fn.exists=function(){return this.length>0}},_extendJavascript:function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})},addSlideToggleListener:function(toClick,toSlide,andDoFn,speed){toClick.click(function(){andDoFn(),toSlide.slideToggle(speed)})},touchclick:function(sel,fnc){$(sel).on("touchstart click",function(event){if(event.stopPropagation(),event.preventDefault(),!0===event.handled)return!1;fnc($(this),event),event.handled=!0})},distanceFromTop:function(element){return $(element).offset().top},distanceFromTopOfContainer:function(element){return $(element).position().top},getParam:function(p){return mb_utils._getQueryParams()[p]},_getQueryParams:function(){var qs=document.location.search;qs=qs.split("+").join(" ");for(var tokens,params={},re=/[?&]?([^=]+)=([^&]*)/g;tokens=re.exec(qs);)params[decodeURIComponent(tokens[1]).toString()]=decodeURIComponent(tokens[2]);return params},toggleText:function(e,a,options){e.preventDefault();var $description_div=$(a).parents(".description"),$long=$description_div.find(".long"),$short=$description_div.find(".short"),speed=(options=options===undefined?{}:options).speed?options.speed:400;if($description_div.hasClass("condensed")){console.log("expand text");var min_h=$short.height();$short.hide(),$long.css("min-height",min_h),$long.slideDown(speed)}else console.log("condense text"),$long.slideUp(speed,function(){$short.show()});$description_div.toggleClass("condensed")},initExpandableElement:function(){$(".expandable_element_link").unbind("click").click(function(){var $el=$(this).closest(".mb_expand").find(".expandable_element"),expandText=$(this).attr("data-expand-text"),contractText=$(this).attr("data-contract-text");if(expandText&&contractText){var txt=$el.is(":visible")?expandText:contractText;$(this).text(txt)}else{if($(this).text().indexOf("+ more")>=0||$(this).text().indexOf("- less")>=0){txt=$el.is(":visible")?"+ more":"- less";$(this).text(txt)}}$el.slideToggle()})},writeToFancybox:function(html_content){$.fancybox({type:"html",content:html_content,openEffect:"none",closeEffect:"none",margin:0,padding:0})},simpleFormat:function(str,wrap){return str=str.replace(/\r\n?/,"\n"),(str=$.trim(str)).length>0&&(str=(str=str.replace(/\n\n+/g,"</p><p>")).replace(/\n/g,"<br />"),wrap&&(str="<p>"+str+"</p>")),str},getIEVersion:function(){var reg=/MSIE\s?(\d+)(?:\.(\d+))?/i,matches=navigator.userAgent.match(reg);return null!=matches?{major:matches[1],minor:matches[2]}:{major:"-1",minor:"-1"}},linkCitationsToFootnotes:function(){var footnotes=$(".wysiwyg_content ol.footnotes li");if(footnotes.exists()){var citations=$(".wysiwyg_content sup").not(".math");$.each(citations,function(){var citation_num=parseInt($(this).text()),footnoteElement=footnotes.get(citation_num-1),footnote=null;footnoteElement&&(footnote=$(footnoteElement)),citation_num&&footnote&&($(this).wrap('<a class="citation" href="#footnote_'+citation_num+'"></a>'),0==footnote.hasClass("footnote")&&(footnote.addClass("footnote"),footnote.wrapInner(function(){return"<div id='footnote_"+citation_num+"'></div>"})))})}$("a.citation").click(function(e){console.log("citation click"),e.preventDefault();var href=$(this).attr("href");console.log("href: "+href);var name=href.replace("#",""),$anchor=$("div[id="+name+"]");mb_utils.slideToElement($anchor,105)})},launch_sized_popup_window:function(desktopURL,w,h,layout,scrollbars){var layout_param="",scrollbars_param="0";layout!=undefined&&(layout_param="?layout="+layout),scrollbars!=undefined&&(scrollbars_param=scrollbars);window.open(desktopURL+layout_param,"_blank","toolbar=0, titlebar=0, menubar=0, scrollbars="+scrollbars_param+", resizable=yes, width="+w+", height="+h);self.name="main"},slideToElement:function(target,offset){var $target;console.log("slideToElement.offset: "+offset),void 0===offset&&(offset=0),$target="string"==typeof target?$(target):target,$("html, body").animate({scrollTop:$target.offset().top-offset},800)},mouseCheck:function(){isMobile.any()||(console.log("mouseCheck"),$("html.touchevents").length>0&&("yes"==mb_utils.readCookie("has_mouse")?$("html").removeClass("touchevents").addClass("no-touchevents"):$(window).one("mousemove",function(){mb_utils.createCookie("has_mouse","yes",1825),$("html").removeClass("touchevents").addClass("no-touchevents")})))},checkSubscribeForm:function(list_id,form_id){var email=$("#"+form_id+"_email").val();$("#"+form_id+"_status").html("loading..."),$.ajax({type:"GET",url:"/subscribe_submit",data:{email:email,list:list_id,form_id:form_id},fail:function(){$("#"+form_id+"_status").html("Could not subscribe. Please try again.")}})},mobileCheck:function(){var a,check=!1;return a=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0),check},mobileAndTabletCheck:function(){var a,check=!1;return a=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0),check},humanize:function(property){return property.replace(/_/g," ").replace(/(\w+)/g,function(match){return match.charAt(0).toUpperCase()+match.slice(1)})},debounce:function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}},isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},iPad:function(){return navigator.userAgent.match(/iPad/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return screen.width<=500||isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};$.extend(mb_utils,{initResponsiveElement:function(element,large_display_container,small_display_container,responsive_breakpoint,moveToSmallOnTouchscreen){void 0===responsive_breakpoint&&(responsive_breakpoint=mb_responsive_utils.getResponsiveBreakpoint()),$(window).bind("load resize",function(){mb_responsive_utils.moveResponsiveElements(element,large_display_container,small_display_container,responsive_breakpoint,moveToSmallOnTouchscreen)})}});var mb_responsive_utils={_responsive_breakpoint:769,setResponsiveBreakpoint:function(new_breakpoint){this._responsive_breakpoint=new_breakpoint},getResponsiveBreakpoint:function(){return this._responsive_breakpoint},moveResponsiveElements:function(element,large_display_container,small_display_container,responsiveBreakpoint,moveToSmallOnTouchscreen){var target_container=$(window).width()<this._responsive_breakpoint?small_display_container:large_display_container;1==moveToSmallOnTouchscreen&&$("html").hasClass("touch")?mb_responsive_utils._moveElementIfNecessary(element,small_display_container):mb_responsive_utils._moveElementIfNecessary(element,target_container)},_moveElementIfNecessary:function(element,targetContainer){$(targetContainer).attr("id")!=undefined&&$(element).parent().attr("id")!=undefined&&$(targetContainer).attr("id")!=$(element).parent().attr("id")&&(console.log("Moving Responsive Element: "+element+" from #"+$(element).parent().attr("id")+" to "+targetContainer),$(element).prependTo(targetContainer))}};$.extend(mb_utils,{createCookie:function(name,value,days){if(console.log("mb_utils.createCookie: "+name,value,days),days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3);var expires="; expires="+date.toGMTString()}else expires="";document.cookie=name+"="+value+expires+"; path=/"},readCookie:function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return console.log("mb_utils.readCookie: "+name,c.substring(nameEQ.length,c.length)),c.substring(nameEQ.length,c.length)}return null},eraseCookie:function(name){mb_utils.createCookie(name,"",-1)}});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=Base64._utf8_encode(input);i<input.length;)enc1=(chr1=input.charCodeAt(i++))>>2,enc2=(3&chr1)<<4|(chr2=input.charCodeAt(i++))>>4,enc3=(15&chr2)<<2|(chr3=input.charCodeAt(i++))>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+Base64._keyStr.charAt(enc1)+Base64._keyStr.charAt(enc2)+Base64._keyStr.charAt(enc3)+Base64._keyStr.charAt(enc4);return output},decode:function(input){var chr1,chr2,chr3,enc2,enc3,enc4,output="",i=0;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)chr1=Base64._keyStr.indexOf(input.charAt(i++))<<2|(enc2=Base64._keyStr.indexOf(input.charAt(i++)))>>4,chr2=(15&enc2)<<4|(enc3=Base64._keyStr.indexOf(input.charAt(i++)))>>2,chr3=(3&enc3)<<6|(enc4=Base64._keyStr.indexOf(input.charAt(i++))),output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3));return output=Base64._utf8_decode(output)},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);c<128?utftext+=String.fromCharCode(c):c>127&&c<2048?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext},_utf8_decode:function(utftext){for(var string="",i=0,c=c1=c2=0;i<utftext.length;)(c=utftext.charCodeAt(i))<128?(string+=String.fromCharCode(c),i++):c>191&&c<224?(c2=utftext.charCodeAt(i+1),string+=String.fromCharCode((31&c)<<6|63&c2),i+=2):(c2=utftext.charCodeAt(i+1),c3=utftext.charCodeAt(i+2),string+=String.fromCharCode((15&c)<<12|(63&c2)<<6|63&c3),i+=3);return string}},mb_responsive_tables={init:function(){$(".wysiwyg_content table, .extra_wide_content").each(function(){var $element=$(this),scrollWrapper=$("<div />",{"class":"table_wrapper",html:"<div />"}).insertBefore($element);$element.data("scrollWrapper",scrollWrapper),$element.appendTo(scrollWrapper.find("div")),$element.outerWidth()>$element.parent().outerWidth()&&$element.data("scrollWrapper").addClass("has-scroll"),$element.find("tr.expandable_element").length>0&&$element.parents(".table_wrapper").parent().addClass("expandable_table_wrapper"),$(window).on("resize orientationchange",function(){$element.outerWidth()>$element.parent().outerWidth()?$element.data("scrollWrapper").addClass("has-scroll"):$element.data("scrollWrapper").removeClass("has-scroll")})})}};!function($){var PLUGIN_NS="more_items",Plugin=function(target,options){return this.$T=$(target),this.options=$.extend(!0,{page_number:0,url:"",button:$(".more_button .button"),entry_selector:target.children("li:last"),build_item_fn:Plugin.prototype.buildItem,more_fn:"getMoreItemsAndAppend"},options),this._init(target,this.options),this};Plugin.prototype._init=function(target,options){options.button.on("click",function(event){event.preventDefault(),$(target).more_items(options.more_fn)})},Plugin.prototype.getMoreItemsAndAppend=function(params){return $(".loading").show(),this.options.button.hide(),this._getMore(params[0]),this.$T},Plugin.prototype.exposeNextPage=function(){this.options.page_number+=1,this.$T.find(".page_"+this.options.page_number).show();var nextPage=this.options.page_number+1;0==this.$T.find(".page_"+nextPage).length&&this.options.button.hide()},Plugin.prototype._getMore=function(params){var self=this;this.options.page_number+=1;var query_params=$.extend(params,{page:this.options.page_number},this.options.params),button=this.options.button;$.getJSON(this.options.url,query_params).done(function(data){for(var html="",i=0;i<data.items.length;i++)html+=self.options.build_item_fn(data.items[i]);""!=html&&(self.options.entry_selector.after(html),self.options.entry_selector=self.$T.children("li:last")),data.error_message&&self.options.entry_selector.after("<hr><div class='error'>"+data.error_message+"</div>"),$(".loading").hide(),data.more&&1==data.more&&button.show()}).fail(function(jqxhr,textStatus,error){var err=textStatus+", "+error;console.log("ajax request failed: "+err)})},Plugin.prototype.buildItem=function(data){var target=data.target?data.target:"_blank",html='<li class="slide">';return html+='<a href="'+data.url.replace('"','"')+'" target="'+target+'">',html+='<div class="image_and_description_container">',html+='<div class="rollover_description">'+data.description,html+='<div class="overlay_arrow">',html+='<img alt="more arrow" src="/assets/overlay-arrow.png">',html+="</div>",html+="</div>",html+='<div class="img">',html+='<img alt="'+data.title.replace('"','"').replace(/(<([^>]+)>)/gi,"")+'" ',html+='class="thumb" src="'+data.thumb+'"></div>',html+='<div class="bottom_gradient">',html+="<div>",html+="<h3>"+data.title+"</h3>",html+="</div>",html+="</div>",html+="</div>",html+='<div class="list_text_content">',$(".list_date").exists()&&(html+='<div class="list_date">',html+=data.date,html+="</div>"),html+='<div class="content_title">',html+=data.title,html+="</div>",html+='<div class="article_teaser_body">',html+=data.description,html+="</div>",html+="</div>",html+="</a>",html+="</li>"},$.fn[PLUGIN_NS]=function(methodOrOptions){if(!$(this).length)return $(this);var instance=$(this).data(PLUGIN_NS);return instance&&0!=methodOrOptions.indexOf("_")&&instance[methodOrOptions]&&"function"==typeof instance[methodOrOptions]?instance[methodOrOptions](Array.prototype.slice.call(arguments,1)):"object"!=typeof methodOrOptions&&methodOrOptions?void(instance?0==methodOrOptions.indexOf("_")?$.error("Method "+methodOrOptions+" is private!"):$.error("Method "+methodOrOptions+" does not exist."):$.error("Plugin must be initialised before using method: "+methodOrOptions)):(instance=new Plugin($(this),methodOrOptions),$(this).data(PLUGIN_NS,instance),$(this))}}(jQuery),mb_parallax={init:function(){var overlay=$(".explore_overlay_page").length>0,featurepage=$("section.feature_pages").length>0;if(mb_utils.mobileAndTabletCheck()||overlay||!featurepage)$(".parallax_module .featured_image").each(function(k,v){overlay?$(v).siblings(".window").remove():$(v).siblings(".window").addClass("mobile");var src=$(v).data("image");$(v).append('<img src="'+src+'"></img>')});else{var ie_version=mb_utils.getIEVersion(),excludedDesktopBrowsers=ie_version.major>1&&ie_version.major<=9;$(".parallax_module .featured_image").each(function(k,v){$(v).imageScroll({container:$(v).closest(".parallax_module"),holderMinHeight:800,parallax:!excludedDesktopBrowsers})})}}},$(document).ready(function(){mb_parallax.init()});var time_series={speed:500,rewind_speed:100,rewind_step:1,playing_ts:null,months:["January","February","March","April","May","June","July","August","September","October","November","December"],init:function(series_selector,start,end,show_by_value){this.initTrackbar(series_selector,start,end,show_by_value),this.initListeners(series_selector)},initTrackbar:function(series_selector,start,end,show_by_value){var month_step,step;show_by_value?step=1:(month_step=1/12,step=time_series._showMonth(series_selector)?month_step:1),$(series_selector+" input.trackbar_controller").edSingleSlider({theme:"mb_gcc",noLabels:!0,noMarkers:!1,minimum:start,maximum:end,step:step,created:function(ev,values){$(series_selector+" .values").html(JSON.stringify(values,null,"  ")),$(series_selector+" .lastValue").text(values.value)}})},initListeners:function(series_selector){$(series_selector+" img").imagesLoaded(function(){console.log("Time series: "+series_selector+", images loaded."),$(series_selector+" .loading_text").hide(),$(series_selector+" .controllers_container").css("visibility","visible")}),$(series_selector+" input").edSingleSlider().on("edslider_slide edslider_change",function(evt,values){time_series.sliderChanged(evt,values,series_selector,!1)}),$(series_selector+" .play_button").click(function(){console.log("Play - "+series_selector),$(series_selector+" .play_button,"+series_selector+" .reset_button").hide(),$(series_selector+" .pause_button").show(),time_series.playing_ts&&clearTimeout(time_series.playing_ts),time_series.moveSlider(series_selector,!0)}),$(series_selector+" .pause_button").click(function(){console.log("Pause - "+series_selector),$(series_selector+" .play_button").show(),$(series_selector+" .pause_button,"+series_selector+" .reset_button").hide(),time_series.playing_ts&&clearTimeout(time_series.playing_ts)}),$(series_selector+" .reset_button").click(function(){time_series.playing_ts&&clearTimeout(time_series.playing_ts),time_series.resetSlider(series_selector)}),$(window).resize(function(){var current_val=$(series_selector+" input").edSingleSlider("getValue").value,slider_width_mb=$(series_selector+" .edss-theme-mb_gcc").width();$(series_selector+" input").edSingleSlider("update",{width:slider_width_mb});$(series_selector+" input").edSingleSlider("value",current_val)})},resetSlider:function(series_selector){$(series_selector+" .play_button,"+series_selector+" .reset_button").hide(),$(series_selector+" .pause_button").show();var min=$(series_selector+" input").edSingleSlider("option","minimum");$(series_selector+" input").edSingleSlider("value",min),time_series.sliderChanged(null,$(series_selector+" input").edSingleSlider("getValue"),series_selector,!0),time_series.playing_ts=setTimeout(function(){time_series.moveSlider(series_selector,!0)},time_series.speed)},moveSlider:function(series_selector,play){var current_val=$(series_selector+" input").edSingleSlider("getValue"),step=$(series_selector+" input").edSingleSlider("option","step"),max=$(series_selector+" input").edSingleSlider("option","maximum");current_val&&!isNaN(current_val.value)&&current_val.value+step>max?($(series_selector+" input").edSingleSlider("value",max),$(series_selector+" .reset_button").show(),$(series_selector+" .pause_button,"+series_selector+" .play_button").hide(),time_series.playing_ts&&clearTimeout(time_series.playing_ts)):current_val&&!isNaN(current_val.value)&&current_val.value<max?($(series_selector+" input").edSingleSlider("value",current_val.value+step),time_series.sliderChanged(null,$(series_selector+" input").edSingleSlider("getValue"),series_selector,play),play&&(time_series.playing_ts=setTimeout(function(){time_series.moveSlider(series_selector,!0)},time_series.speed))):console.log("ERROR: timeseries.moveslider: current_val is not >= max, or < max.")},sliderChanged:function(evt,values,series_selector,play){if(time_series._showMonth(series_selector))time_series.monthSliderChanged(evt,values,series_selector,play);else{var last_value=$(series_selector+" .lastValue").text(),new_val=values.value.toFixed(0);if(isNaN(values.value))console.log("Value is NaN. Do nothing.");else if(new_val==last_value);else{$(series_selector+" .lastValue").text(new_val);var image_selector=series_selector+" .image"+series_selector+"_image_"+new_val;$(image_selector).length>0?time_series.changeImage(image_selector):time_series.moveSlider(series_selector,play)}$(series_selector+" .values").html(JSON.stringify(values,null,"  "))}},monthSliderChanged:function(evt,values,series_selector,play){if(isNaN(values.value))console.log("Value is NaN. Do nothing.");else{var last_year_value=$(series_selector+" .lastValue").text(),last_month_value=$(series_selector+" .monthValue").text(),d=time_series.convertDecimalDate(values.value),year=d.getFullYear(),month=time_series.months[d.getMonth()],image_selector=series_selector+" .image"+series_selector+"_image_"+year+month;$(image_selector).length>0?(time_series.changeImage(image_selector),last_year_value!=year&&$(series_selector+" .lastValue").text(year),last_month_value!=month&&$(series_selector+" .monthValue").text(month)):(console.log("image does not exist for:"+image_selector),time_series.moveSlider(series_selector,play)),$(series_selector+" .values").html(JSON.stringify(values,null,"  "))}},convertDecimalDate:function(yearfrac){var year=parseInt(yearfrac),x_month=parseFloat(yearfrac)-year,month=Math.floor(12*x_month-.5);return new Date(year,month,1)},_showMonth:function(selector){return $(selector+" .monthValue").length>0},changeImage:function(selector){$(selector).addClass("current"),$(selector).siblings(".image").removeClass("current")}},nav={init:function(){this.initListeners()},initListeners:function(){$("a#menu_button").click(function(event){event.preventDefault(),$("#site_nav_container").show(),$(".site_header_area").addClass("menu_open"),$("a#menu_button").hide(),$("body").addClass("nav_overlay_true")}),$("a.modal_close").click(function(event){event.preventDefault(),$("#site_nav_container").hide(),$(".site_header_area").removeClass("menu_open"),$("a#menu_button").show(),$("body").removeClass("nav_overlay_true")}),$(window).scroll(function(){var st=$(this).scrollTop();main.lastScrollTop;main.lastScrollTop=st,$(window).scrollTop()>0?($(".site_header_area").addClass("fixed"),$(".site_header_area").addClass("fixed_show"),$("body").addClass("nav_is_fixed")):($(".site_header_area").removeClass("fixed"),$(".site_header_area").removeClass("fixed_show"),$("body").removeClass("nav_is_fixed"))})}},grid_list_page={filterPos:"",init:function(){this.initGridListButtons(),this.initFilterBar()},initGridListButtons:function(){$(".nav_item.list_icon").click(function(){$(this).parents("section").removeClass("grid_view"),$(this).parents("section").addClass("list_view")}),$(".nav_item.grid_icon").click(function(){$(this).parents("section").removeClass("list_view"),$(this).parents("section").addClass("grid_view")})},initFilterBar:function(){$(".filter_bar").exists()&&(mb_utils.touchclick(".filter_bar header",function(){$(".filter_bar .arrow_box").is(":visible")&&($(".filter_bar .arrow_box").toggleClass("rotate_up"),$(".section_search").toggle())}),$(".filter_bar .filter").change(function(){this.form.submit()}))}},main={spinner_opts:{lines:8,length:5,width:3,radius:6,color:"#000",speed:1,trail:100,shadow:!1,className:"spinner",top:"20px",left:"50%"},mousePos:{x:-1,y:-1},lastScrollTop:0,nav_search_open:!1,nav_search_orig_size:null,changePage:function(value,label){"Website"==label&&window.open(value,"_blank"),window.location=value},init:function(){mb_utils.init(),main.initListeners(),nav.init(),0==$('[data-react-class="GridListPage"]').length&&0==$('[data-react-class="GridList"]').length&&grid_list_page.init(),mb_responsive_tables.init(),this._checkAndSetFormElementsBasedOnQueryParams(),mb_utils.linkCitationsToFootnotes(),mb_utils.initExpandableElement(),mb_utils.mouseCheck(),this.initTooltips()},initListeners:function(){if($(".has_tooltip").tooltipsy({alignTo:"element",delay:0,offset:[1,0],css:{"margin-left":"10px"}}),$(".has_tooltip_bottom").tooltipsy({alignTo:"element",delay:0,offset:[0,1],css:{"margin-top":"5px"}}),main.setupVitalSignsTooltips(),isMobile.any()){var featured_image_9x16=$("#featured_image").attr("data-mobile-image"),featured_image_16x9=$("#featured_image").attr("data-image");$("#featured_image").siblings(".window").addClass("mobile");var picture_el='<picture><source srcset="'+featured_image_16x9+'"media="(min-width: 600px)"><source srcset="'+featured_image_9x16+'"/><img src="'+featured_image_9x16+'"></picture>';$("#featured_image").append(picture_el)}else{var ie_version=mb_utils.getIEVersion(),excludedDesktopBrowsers=ie_version.major>1&&ie_version.major<=9;excludedDesktopBrowsers||$(".missions_teaser").addClass("parallax"),$("#featured_image").imageScroll({container:$(".media_feature").first(),holderMinHeight:800,parallax:!excludedDesktopBrowsers})}var margin,arrows;$(".nav_search .search_submit").click(function(){null==main.nav_search_orig_size&&(main.nav_search_orig_size=$(".nav_search .search_field").css("width")),$(".nav_search .search_field").css("width")==main.nav_search_orig_size?($(".nav_search .search_field").css("width","100%").addClass("search_open"),$(".nav_search .search_field").focus(),main.nav_search_open=!0):$(".nav_search .search_field").val()?$(".nav_search").submit():($(".nav_search .search_field").css("width",main.nav_search_orig_size).removeClass("search_open"),main.nav_search_open=!1)}),mb_utils.mobileAndTabletCheck()||$(".fancybox").fancybox({maxWidth:$(window).width()-64,fitToView:!1,openEffect:"none",closeEffect:"none",padding:0}),isMobile.any()?(margin=[20,20,20,20],arrows=!1):(margin=[30,55,30,55],arrows=!0),$("a.fancybox_video").fancybox({fitToView:!1,autoscale:!1,margin:margin,autoSize:!1,closeClick:!1,closeBtn:!1,openEffect:"none",closeEffect:"none",nextEffect:"fade",prevEffect:"fade",mouseWheel:!1,theme:"mb-video",arrows:arrows,beforeShow:function(){video&&$(video.video_div).exists()&&jwplayer(video.video_div).pause(!0)}}),$(".fancybox_info").fancybox({openEffect:"none",closeEffect:"none",closeBtn:!1,mouseWheel:!1,maxWidth:$(window).width()-165,maxHeight:$(window).height(),fitToView:!1,width:"100%",height:"100%",autoSize:!1,theme:"mb-info",beforeLoad:function(){this.title=main.constructFancyBoxInfo(this.element,!0)},afterShow:function(){$(".close_button").click(function(){parent.$.fancybox.close()}),ReactRailsUJS.mountComponents()},padding:0})},resizeFancybox:function(inner_h){if(console.log(inner_h),$(".fancybox-wrap").exists()){var delta=50;$(".fancybox-wrap,.fancybox-inner").height(inner_h+delta)}},initTooltips:function(){$(".glossary_link").tooltipster({content:"Loading...",contentAsHTML:!0,maxWidth:320,minWidth:320,onlyOne:!0,interactive:!0,updateAnimation:!1,position:"top-right",functionInit:function(){$(".glossary_link").on("setPosition",function(event,e){gl_offset=$(this).offset(),$(this).tooltipster("option","offsetX",e.pageX-gl_offset.left-$(this).innerWidth()),$(this).tooltipster("option","offsetY",gl_offset.top-e.pageY+14),$(this).tooltipster("reposition")}),$(".glossary_link").on("mouseenter",function(e){$(this).trigger("setPosition",[e])})},functionAfter:function(origin){$(origin).removeClass("open"),$(origin).on("setPosition",function(event,e){gl_offset=$(this).offset(),$(this).tooltipster("option","offsetX",e.pageX-gl_offset.left-$(this).innerWidth()),$(this).tooltipster("option","offsetY",gl_offset.top-e.pageY+14),$(this).tooltipster("reposition")})},functionReady:function(origin){$(origin).off("setPosition")},functionBefore:function(origin,continueTooltip){if(continueTooltip(),"cached"!==origin.data("ajax")){var url="/api/v1/glossary_items/",href=$(origin).attr("href"),matches=href.match(/ss_id=(\d+)/);if(1==matches.length)return;url+=matches[1],$.ajax({type:"GET",url:url,success:function(data){var html="<div class='glossary_tooltip' data-href='"+href+"'><h3>"+data.title+"</h3><div class='definition'>"+data.definition+"</div>";"undefined"!=typeof data.credit&&""!=data.credit?html+="<div class='credit'>Source: "+data.credit+"</div></div>":html+="</div>",origin.tooltipster("content",html).data("ajax","cached"),$(".glossary_tooltip").click(function(e){e.preventDefault(),window.location=$(this).data("href")}),
$(".glossary_tooltip a").click(function(e){e.preventDefault(),e.stopPropagation(),window.location=$(this).attr("href")})}})}}}),mb_utils.mobileAndTabletCheck()&&$(".glossary_link").click(function(e){e.preventDefault(),$(this).hasClass("open")?window.location=this.href:$(this).addClass("open")})},setupVitalSignsTooltips:function(){$(".rollover_vital_signs").tooltipsy({alignTo:"element",delay:0,offset:[0,-1],content:"CLICK TO EXPAND",show:function(e,$el){$("#vital_signs_modal .content").hasClass("visible")||$el.show()},className:"expand_hint"})},constructFancyBoxInfo:function(item){console.log("constructFancyBoxInfo");var share_props={share:[["Facebook"],["Twitter"],["Pinterest"],["Email"]],url:window.location.origin+$(item).attr("data-link"),share_text:$(item).attr("data-title")},strVar="";return strVar+='<div id="fancybox_info">',strVar+=' <div class="image_details">',strVar+='\t <div class="buttons clearfix">',strVar+='   <div class="close_button"></div>',strVar+='\t   <div class="inner_buttons">',strVar+=" <div class='share_button_component' data-react-class=\"ShareButton\" data-react-props='"+JSON.stringify(share_props)+"' />",strVar+='\t   <a class="button" href="'+$(item).attr("data-link")+' " target="_top">',strVar+="more info",strVar+="\t   </a>",strVar+="\t  </div>",strVar+="\t </div>",strVar+='\t <div class="text">',strVar+='\t  <h2 class="title">',strVar+=$(item).attr("data-title"),strVar+="\t  </h2>",strVar+='\t  <div class="description">',strVar+=$(item).attr("data-description"),strVar+="\t  </div>",$(item).attr("data-credit")!=undefined&&(strVar+='\t  <div class="image_caption">',strVar+=$(item).attr("data-credit"),strVar+="\t  </div>"),strVar+="  </div>",strVar+=" </div>",strVar+="</div>"},checkSubscribeForm:function(){var email=$("#newsletter_subscribe_email").val(),at_pos=email.indexOf("@"),dot_pos=email.lastIndexOf(".");if(at_pos<1||dot_pos<at_pos+2||dot_pos+2>=email.length)return alert("Not a valid e-mail address"),!1;$.post("/newsletter_subscribe_submit",{email:email})},_checkAndSetFormElementsBasedOnQueryParams:function(){if("undefined"!=typeof form_params)for(var i=0;i<form_params.length;i++){var param=mb_utils.getParam(form_params[i].param);param&&(console.log("setting "+form_params[i].selector+" to "+param),$(form_params[i].selector).val(param))}}};$(function(){main.init()});